<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Kuvagalleria: /var/www/galleria/data/lib/site.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.4 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Packages</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul>
</div>
<h1>/var/www/galleria/data/lib/site.php</h1><a href="site_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00019"></a><a class="code" href="classGalleria__Site.html">00019</a> <span class="keyword">class </span><a class="code" href="classGalleria__Site.html">Galleria_Site</a>
<a name="l00020"></a>00020 {
<a name="l00021"></a>00021 
<a name="l00029"></a><a class="code" href="classGalleria__Site.html#6e027e589d9165b9cd4ccea0584a6477">00029</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <a class="code" href="classGalleria__Site.html#6e027e589d9165b9cd4ccea0584a6477">$_page</a> = 'index';
<a name="l00033"></a><a class="code" href="classGalleria__Site.html#e207c3361e57d11091688f780f6c636b">00033</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <a class="code" href="classGalleria__Site.html#e207c3361e57d11091688f780f6c636b">$_subpage</a> = 'index';
<a name="l00037"></a><a class="code" href="classGalleria__Site.html#ab0baf162b547b13eff15350e24d74a0">00037</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <a class="code" href="classGalleria__Site.html#ab0baf162b547b13eff15350e24d74a0">$_requests</a> = null;
<a name="l00041"></a><a class="code" href="classGalleria__Site.html#c059ed5583119f356939eada1ed40125">00041</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <a class="code" href="classGalleria__Site.html#c059ed5583119f356939eada1ed40125">$_model</a> = null;
<a name="l00045"></a><a class="code" href="classGalleria__Site.html#2853482867059add7fbc3fb82c85ef3b">00045</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <a class="code" href="classGalleria__Site.html#2853482867059add7fbc3fb82c85ef3b">$_viewpath</a> = null;
<a name="l00049"></a><a class="code" href="classGalleria__Site.html#fd6975b34472f56f8ca121cc907dfd99">00049</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <a class="code" href="classGalleria__Site.html#fd6975b34472f56f8ca121cc907dfd99">$_controller</a> = null;
<a name="l00059"></a><a class="code" href="classGalleria__Site.html#0205e9ec939ea924e25e3650e7a19b70">00059</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classGalleria__Site.html#0205e9ec939ea924e25e3650e7a19b70">render</a>()
<a name="l00060"></a>00060     {
<a name="l00061"></a>00061         self::_parseParams();
<a name="l00062"></a>00062         self::_quickRender();
<a name="l00063"></a>00063         self::_redir();
<a name="l00064"></a>00064         self::_activateView();
<a name="l00065"></a>00065         <span class="keywordflow">return</span>;
<a name="l00066"></a>00066     }
<a name="l00067"></a>00067 
<a name="l00076"></a><a class="code" href="classGalleria__Site.html#7a8c28e40e6a5f3ac9896378c29d3e54">00076</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classGalleria__Site.html#7a8c28e40e6a5f3ac9896378c29d3e54">_quickRender</a>()
<a name="l00077"></a>00077     {
<a name="l00078"></a>00078         self::_loadView();
<a name="l00079"></a>00079         self::_loadModel();
<a name="l00080"></a>00080         self::_loadController();
<a name="l00081"></a>00081     }
<a name="l00082"></a>00082 
<a name="l00091"></a><a class="code" href="classGalleria__Site.html#e0ce26478006db25f6b28f9763217e5a">00091</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classGalleria__Site.html#e0ce26478006db25f6b28f9763217e5a">_parseParams</a>()
<a name="l00092"></a>00092     {
<a name="l00093"></a>00093         $stringParams = preg_replace('/^' . str_replace(<span class="charliteral">'/'</span>, <span class="charliteral">'\/'</span>, <a class="code" href="bootstrap_8php.html#16ccc7c3a9575ef91fa9bc487d5d7cfa">WWWROOT</a>) . <span class="charliteral">'/'</span>, '', $_SERVER['REQUEST_URI']);
<a name="l00094"></a>00094         $arrayParams = explode(<span class="charliteral">'/'</span>, $stringParams, 3);
<a name="l00095"></a>00095         $pageCell = isset($arrayParams[0]) ? $arrayParams[0] : null;
<a name="l00096"></a>00096         $subpageCell = isset($arrayParams[1]) ? $arrayParams[1] : null;
<a name="l00097"></a>00097         self::$_page = ctype_alpha($pageCell) ? $pageCell : 'Index';
<a name="l00098"></a>00098         self::$_subpage = (ctype_alpha($subpageCell) &amp;&amp; self::$_page !== 'Index') ? $subpageCell : 'Index';
<a name="l00099"></a>00099         self::$_requests = <span class="keyword">new</span> <a class="code" href="classGalleria__Requests.html">Galleria_Requests</a>($_GET, array_merge($_POST, $_FILES));
<a name="l00100"></a>00100         <span class="keywordflow">return</span>;
<a name="l00101"></a>00101     }
<a name="l00102"></a>00102 
<a name="l00111"></a><a class="code" href="classGalleria__Site.html#f02798a462fc9f0e66017965bdaf25a4">00111</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classGalleria__Site.html#f02798a462fc9f0e66017965bdaf25a4">_loadModel</a>()
<a name="l00112"></a>00112     {
<a name="l00113"></a>00113         $modelName = self::$_page . 'Model';
<a name="l00114"></a>00114         self::$_model = (@include <a class="code" href="bootstrap_8php.html#f0509a35b2e3e6591d5418e8df136c6c">PATH_DATA_SITE_MVC_MODEL</a> . <span class="charliteral">'/'</span> . strtolower($modelName) . '.php') ? <span class="keyword">new</span> $modelName() : null;
<a name="l00115"></a>00115         <span class="keywordflow">return</span>;
<a name="l00116"></a>00116     }
<a name="l00117"></a>00117 
<a name="l00126"></a><a class="code" href="classGalleria__Site.html#6eb1190bd3699b8f85e44d68fdcda9eb">00126</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classGalleria__Site.html#6eb1190bd3699b8f85e44d68fdcda9eb">_loadView</a>()
<a name="l00127"></a>00127     {
<a name="l00128"></a>00128         $viewName = self::$_page . <span class="charliteral">'/'</span> . self::$_subpage;
<a name="l00129"></a>00129         $filePath = <a class="code" href="bootstrap_8php.html#1ff55716fb99ae3dff0a5e1c3e95edc4">PATH_DATA_SITE_MVC_VIEW_SCRIPTS</a> . <span class="charliteral">'/'</span> . strtolower($viewName) . '.phtml';
<a name="l00130"></a>00130         self::$_viewpath = file_exists($filePath) ? $filePath : null;
<a name="l00131"></a>00131         <span class="keywordflow">return</span>;
<a name="l00132"></a>00132     }
<a name="l00133"></a>00133 
<a name="l00142"></a><a class="code" href="classGalleria__Site.html#6bfe1443ad144256c846b760f2fb2962">00142</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classGalleria__Site.html#6bfe1443ad144256c846b760f2fb2962">_loadController</a>()
<a name="l00143"></a>00143     {
<a name="l00144"></a>00144         $controllerName = self::$_page . 'Controller';
<a name="l00145"></a>00145         $actionName = self::$_subpage . 'Action';
<a name="l00146"></a>00146 
<a name="l00147"></a>00147         <span class="keywordflow">if</span> (!@include <a class="code" href="bootstrap_8php.html#84e49600995b953a0b135da80e14882f">PATH_DATA_SITE_MVC_CONTROLLER</a> . <span class="charliteral">'/'</span> . strtolower($controllerName) . '.php') {
<a name="l00148"></a>00148             self::$_page = 'Error';
<a name="l00149"></a>00149             self::$_subpage = 'Pagenotfound';
<a name="l00150"></a>00150             <span class="keywordflow">return</span> self::_quickRender();
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153         $activeController = <span class="keyword">new</span> $controllerName(self::$_subpage, self::$_model, self::$_requests);
<a name="l00154"></a>00154         <span class="keywordflow">if</span> ($activeController-&gt;before()) {
<a name="l00155"></a>00155             $activeController-&gt;$actionName();
<a name="l00156"></a>00156             <span class="keywordflow">if</span> (!$activeController-&gt;after())
<a name="l00157"></a>00157                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception('Controller failed.');
<a name="l00158"></a>00158         } <span class="keywordflow">else</span> {
<a name="l00159"></a>00159             self::$_page = $activeController-&gt;getPage();
<a name="l00160"></a>00160             self::$_subpage = $activeController-&gt;getSubpage();
<a name="l00161"></a>00161             <span class="keywordflow">return</span> self::_quickRender();
<a name="l00162"></a>00162         }
<a name="l00163"></a>00163         self::$_controller = $activeController;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         <span class="keywordflow">return</span>;
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167 
<a name="l00176"></a><a class="code" href="classGalleria__Site.html#4182ad469dc58ec4b50164c7b227af8d">00176</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classGalleria__Site.html#4182ad469dc58ec4b50164c7b227af8d">_activateView</a>()
<a name="l00177"></a>00177     {
<a name="l00178"></a>00178         $html_url = <a class="code" href="bootstrap_8php.html#16ccc7c3a9575ef91fa9bc487d5d7cfa">WWWROOT</a>;
<a name="l00179"></a>00179         <span class="keywordflow">if</span> (self::$_controller-&gt;getView()-&gt;<a class="code" href="classGalleria__Site.html#0205e9ec939ea924e25e3650e7a19b70">render</a>()) {
<a name="l00180"></a>00180             $view = self::$_controller-&gt;getView();
<a name="l00181"></a>00181             ob_start();
<a name="l00182"></a>00182             <span class="keywordflow">if</span> (!@include self::$_viewpath)
<a name="l00183"></a>00183                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception('View script doesn\'t exist.');
<a name="l00184"></a>00184             $content = ob_get_contents();
<a name="l00185"></a>00185             ob_clean();
<a name="l00186"></a>00186         } <span class="keywordflow">else</span>
<a name="l00187"></a>00187             echo <span class="stringliteral">"do not render"</span>;
<a name="l00188"></a>00188         <span class="keywordflow">if</span> (self::$_controller-&gt;getView()-&gt;renderLayout()) {
<a name="l00189"></a>00189             $page_content = $content;
<a name="l00190"></a>00190             ob_start();
<a name="l00191"></a>00191             <span class="keywordflow">if</span> (!@include <a class="code" href="bootstrap_8php.html#271f545d5669122eee421c798ff98d17">PATH_DATA_SITE_MVC_VIEW_LAYOUT</a> . '/<span class="keywordflow">default</span>.phtml')
<a name="l00192"></a>00192                 <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception('Layout script doesn\'t exist.');
<a name="l00193"></a>00193             $renderedView = ob_get_contents();
<a name="l00194"></a>00194             ob_clean();
<a name="l00195"></a>00195         } <span class="keywordflow">else</span> {
<a name="l00196"></a>00196             $renderedView = $content;
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198         echo $renderedView;
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200 
<a name="l00209"></a><a class="code" href="classGalleria__Site.html#5cd7b65e4380a16ae7ef0a28e00e8e70">00209</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classGalleria__Site.html#5cd7b65e4380a16ae7ef0a28e00e8e70">_redir</a>()
<a name="l00210"></a>00210     {
<a name="l00211"></a>00211         $cont = self::$_controller;
<a name="l00212"></a>00212         <span class="keywordflow">if</span> ($cont-&gt;isRedirected()) {
<a name="l00213"></a>00213             $page = <a class="code" href="bootstrap_8php.html#16ccc7c3a9575ef91fa9bc487d5d7cfa">WWWROOT</a>;
<a name="l00214"></a>00214             $page = ($cont-&gt;getPage() == 'index' &amp;&amp; $cont-&gt;getSubpage() == 'index') ? $page : $page . $cont-&gt;getPage();
<a name="l00215"></a>00215             $page = ($cont-&gt;getSubpage() == 'index') ? $page : $page . $cont-&gt;getSubpage();
<a name="l00216"></a>00216             header('Location: ' . $page);
<a name="l00217"></a>00217         }
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 }
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Wed Apr 29 01:27:26 2009 for Kuvagalleria by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.4 </small></address>
</body>
</html>
